<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Evaluation Workbench</title>
    <style>
        body, html { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f9; color: #333; }
        .workbench-container { display: flex; flex-direction: column; height: 100vh; }
        .workbench-header { padding: 10px 20px; background-color: #fff; border-bottom: 2px solid #dee4e9; text-align: center; flex-shrink: 0; }
        .workbench-body { display: flex; flex-grow: 1; overflow: hidden; }
        .source-panel { flex: 0 0 35%; padding: 20px; background-color: #e9eef2; border-right: 2px solid #dee4e9; overflow-y: auto; }
        .main-panel { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .tabs { display: flex; flex-wrap: wrap; border-bottom: 2px solid #dee4e9; background-color: #fdfdfd; padding: 0 20px; flex-shrink: 0; }
        .tab-button { padding: 15px 20px; cursor: pointer; border: none; background-color: transparent; font-size: 16px; border-bottom: 3px solid transparent; }
        .tab-button.active { font-weight: bold; color: #0056b3; border-bottom: 3px solid #0056b3; }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }
        .wizard-page { display: none; margin-bottom: 20px; }
        .wizard-page.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .wizard-context-header { padding: 15px; background-color: #fff; border: 1px solid #ddd; margin-bottom: 20px; border-radius: 8px; max-height: 250px; overflow-y: auto; }
        .wizard-nav { margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .wizard-nav-button { padding: 10px 20px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; cursor: pointer; background-color: #fff; }
        .question-block { margin: 25px 0; border-left: 3px solid #007bff; padding-left: 15px;}
        .question-block label { font-weight: bold; display: block; margin-bottom: 8px; }
        .radio-option-label { display: block; margin-bottom: 5px; }
        #submit-button-container { display: none; text-align: center; padding: 30px; }
        #submit-button { padding: 15px 25px; background-color: #28a745; color: white; border-radius: 8px; font-size: 20px; font-weight: bold; border: none; cursor: pointer; }
        #submit-button:disabled { background-color: #999; }
        mark { background-color: #ffeb3b; padding: 2px 0; border-radius: 3px; }
        .tooltip-container { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border: 1px solid #0056b3; border-radius: 50%; font-size: 10px; font-weight: bold; color: #0056b3; margin-left: 8px; position: relative; cursor: help; vertical-align: middle; }
        .tooltip-text { visibility: hidden; opacity: 0; width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 6px; padding: 8px; position: absolute; z-index: 1; bottom: 150%; left: 50%; margin-left: -125px; transition: opacity 0.3s; font-weight: normal; }
        .tooltip-text::after { content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px; border-width: 5px; border-style: solid; border-color: #333 transparent transparent transparent; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        .question-description { font-weight: normal; color: #555; margin-left: 6px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="workbench-container">
    <div class="workbench-header"><h1 id="study-title">Document Simplification Evaluation</h1></div>
    <form id="evaluation-form">
        <div class="workbench-body">
            <aside id="source-panel" class="source-panel"></aside>
            <main class="main-panel">
                <div id="tabs-container" class="tabs"></div>
                <div id="content-container"></div>
                <div id="submit-button-container">
                    <button type="submit" id="submit-button">Submit All Evaluations</button>
                </div>
            </main>
        </div>
    </form>
</div>

<script>
// =======================================================================
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzLJNvnP5Z1vW1w3MxaLygN-1b7aBU5DRM30i7w3LFRFNXt6AoC7FDgoovhTOEsYWAQ/exec';
const PROLIFIC_COMPLETION_URL = 'PASTE_PROLIFIC_URL_HERE';
// =======================================================================
// === DATA INJECTION POINT (These will be replaced by Python) ===
const taskData = [
    {
        "title": "Edward Mitchell Bannister",
        "model_id": "claude_editor",
        "original": "Edward Mitchell Bannister (November 2, 1828 \u2013 January 9, 1901) was a Canadian\u2013American oil painter of the American Barbizon school. Born in colonial New Brunswick, he spent his adult life in New England in the United States. There, along with his wife Christiana Carteaux, he was a prominent member of African-American cultural and political communities, such as the Boston abolition movement. Bannister received national recognition after he won a first prize in painting at the 1876 Philadelphia Centennial Exhibition. He was also a founding member of the Providence Art Club and the Rhode Island School of Design.\nBannister's style and predominantly pastoral subject matter reflected his admiration for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school. A lifelong sailor, he also looked to the Rhode Island seaside for inspiration. Bannister continually experimented, and his artwork displays his Idealist philosophy and his control of color and atmosphere. He began his professional practice as a photographer and portraitist before developing his better-known landscape style.\nLater in his life, Bannister's style of landscape painting fell out of favor. With decreasing painting sales, he and Christiana Carteaux moved out of College Hill in Providence to Boston and then a smaller house on Wilson Street in Providence. Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.\n\n",
        "simplified": "Edward Mitchell Bannister was a painter who lived from 1828 to 1901. He was born in Canada but spent most of his life in the United States. Bannister was known for his oil paintings of nature scenes, similar to a group of French artists called the Barbizon school.\n\nBannister and his wife, Christiana Carteaux, were important members of the African-American community. They were involved in movements to end slavery in Boston. In 1876, Bannister won a major prize at a big art show in Philadelphia. This made him famous across the country. He also helped start an art club in Providence and an art school in Rhode Island.\n\nBannister loved to paint outdoor scenes, especially those inspired by the seaside in Rhode Island. He was also a sailor. His paintings show his skill with colors and creating mood. He started his career as a photographer and portrait painter before focusing on landscapes.\n\nAs he got older, people became less interested in Bannister's style of painting. He and his wife had to move to smaller homes because they weren't selling as many paintings. After Bannister died in 1901, people forgot about him for many years. It wasn't until the 1960s and 1970s that museums started to show his work again and remind people of his importance.",
        "evaluation": {
            "overall_questions": [
                {
                    "key": "fluency",
                    "label": "Fluency: How grammatically correct and well-formed are the sentences?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Many sentences are ungrammatical or nonsensical."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Some sentences are awkward or contain errors."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Mostly fluent, with a few minor awkward phrases."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The text reads naturally with no errors."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The language is exceptionally well-formed and articulate."
                        }
                    ]
                },
                {
                    "key": "clarity",
                    "label": "Clarity: As a stand-alone text, how clear and easy is it to understand the main points?",
                    "options": [
                        {
                            "label": "1 - Very Unclear",
                            "description": "The text is confusing and the main points are hard to grasp."
                        },
                        {
                            "label": "2 - Unclear",
                            "description": "Some parts of the text are confusing or ambiguous."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is generally understandable, but could be clearer."
                        },
                        {
                            "label": "4 - Clear",
                            "description": "The text is easy to understand."
                        },
                        {
                            "label": "5 - Very Clear",
                            "description": "The text is exceptionally easy to follow and unambiguous."
                        }
                    ]
                },
                {
                    "key": "conciseness",
                    "label": "Conciseness: Is the text succinct or does it use unnecessary words?",
                    "options": [
                        {
                            "label": "1 - Very Wordy",
                            "description": "The text is highly repetitive or uses many unnecessary words."
                        },
                        {
                            "label": "2 - Wordy",
                            "description": "The text is somewhat repetitive or wordy."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is mostly concise but could be tightened."
                        },
                        {
                            "label": "4 - Concise",
                            "description": "The text is direct and to the point."
                        },
                        {
                            "label": "5 - Very Concise",
                            "description": "Every word serves a clear purpose."
                        }
                    ]
                },
                {
                    "key": "style",
                    "label": "Style: How appropriate and natural is the writing style?",
                    "options": [
                        {
                            "label": "1 - Very Unnatural",
                            "description": "The style feels robotic, 'dumbed down,' or childish."
                        },
                        {
                            "label": "2 - Slightly Unnatural",
                            "description": "The style is a bit simplistic or awkward in places."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The style is functional but not particularly engaging."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The style is clear, simple, and appropriate for a general audience."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The style is engaging and perfectly suited for the topic."
                        }
                    ]
                },
                {
                    "key": "overall_impression",
                    "label": "Overall: As a stand-alone piece of writing, what is your overall impression of this text?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Unacceptable quality, many flaws."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Has significant flaws that detract from the text."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Generally okay, but with noticeable room for improvement."
                        },
                        {
                            "label": "4 - Good",
                            "description": "Well-written and effective with only minor issues."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "Exceptionally clear, fluent, and well-written."
                        }
                    ]
                }
            ],
            "simplicity_issues": [
                {
                    "type": "meaning",
                    "original_span": "Born in colonial New Brunswick, he spent his adult life in New England in the United States.",
                    "simplified_span": "He was born in Canada but spent most of his life in the United States.",
                    "explanation": "The original specifies that Bannister was born in colonial New Brunswick, which is a specific historical context, whereas the simplified version generalizes this to 'Canada,' losing the historical nuance.",
                    "suggested_fix": "He was born in colonial New Brunswick, Canada, but spent most of his life in the United States."
                },
                {
                    "type": "meaning",
                    "original_span": "Bannister received national recognition after he won a first prize in painting at the 1876 Philadelphia Centennial Exhibition.",
                    "simplified_span": "In 1876, Bannister won a major prize at a big art show in Philadelphia. This made him famous across the country.",
                    "explanation": "The simplified version omits the specific name of the exhibition, 'Philadelphia Centennial Exhibition,' which is an important detail for historical context.",
                    "suggested_fix": "In 1876, Bannister won a first prize in painting at the Philadelphia Centennial Exhibition, which made him famous across the country."
                },
                {
                    "type": "meaning",
                    "original_span": "Bannister's style and predominantly pastoral subject matter reflected his admiration for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school.",
                    "simplified_span": "Bannister was known for his oil paintings of nature scenes, similar to a group of French artists called the Barbizon school.",
                    "explanation": "The simplified version omits Bannister's specific admiration for the French artist Jean-Fran\u00e7ois Millet, which is a key influence on his work.",
                    "suggested_fix": "Bannister was known for his oil paintings of nature scenes, reflecting his admiration for the French artist Jean-Fran\u00e7ois Millet and similar to a group of French artists called the Barbizon school."
                },
                {
                    "type": "meaning",
                    "original_span": "Bannister continually experimented, and his artwork displays his Idealist philosophy and his control of color and atmosphere.",
                    "simplified_span": "His paintings show his skill with colors and creating mood.",
                    "explanation": "The simplified version omits the mention of Bannister's 'Idealist philosophy,' which is an important aspect of his artistic approach.",
                    "suggested_fix": "His paintings show his skill with colors, creating mood, and reflect his Idealist philosophy."
                },
                {
                    "type": "meaning",
                    "original_span": "Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.",
                    "simplified_span": "After Bannister died in 1901, people forgot about him for many years. It wasn't until the 1960s and 1970s that museums started to show his work again and remind people of his importance.",
                    "explanation": "The simplified version omits the specific mention of the 'National Museum of African Art,' which played a significant role in reviving interest in Bannister's work.",
                    "suggested_fix": "After Bannister died in 1901, people forgot about him for many years. It wasn't until the 1960s and 1970s, when institutions like the National Museum of African Art started to show his work again, that people were reminded of his importance."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "similar to a group of French artists called the Barbizon school",
                    "explanation": "The phrase 'similar to a group of French artists called the Barbizon school' introduces a comparison without explaining who the Barbizon school artists are, which may confuse readers unfamiliar with art history.",
                    "suggested_fix": "similar to a group of French artists known for their realistic depictions of rural life, called the Barbizon school"
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "This made him famous across the country.",
                    "explanation": "The sentence 'This made him famous across the country.' is somewhat vague about what 'this' refers to, which could confuse readers.",
                    "suggested_fix": "Winning the prize made him famous across the country."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "Bannister loved to paint outdoor scenes, especially those inspired by the seaside in Rhode Island. He was also a sailor.",
                    "explanation": "The transition between Bannister's love for painting outdoor scenes and his being a sailor is abrupt and lacks a clear connection.",
                    "suggested_fix": "Bannister loved to paint outdoor scenes, especially those inspired by the seaside in Rhode Island, which he often explored as a sailor."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "He started his career as a photographer and portrait painter before focusing on landscapes.",
                    "explanation": "The sentence structure is slightly clunky and could be made smoother for better fluency.",
                    "suggested_fix": "He began his career as a photographer and portrait painter, eventually focusing on landscapes."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "As he got older, people became less interested in Bannister's style of painting.",
                    "explanation": "The phrase 'As he got older, people became less interested in Bannister's style of painting.' lacks a clear logical connector to explain why this change in interest occurred.",
                    "suggested_fix": "As he got older, changing art trends led to a decline in interest in Bannister's style of painting."
                }
            ]
        }
    },
    {
        "title": "Edward Mitchell Bannister",
        "model_id": "openai_editor",
        "original": "Edward Mitchell Bannister (November 2, 1828 \u2013 January 9, 1901) was a Canadian\u2013American oil painter of the American Barbizon school. Born in colonial New Brunswick, he spent his adult life in New England in the United States. There, along with his wife Christiana Carteaux, he was a prominent member of African-American cultural and political communities, such as the Boston abolition movement. Bannister received national recognition after he won a first prize in painting at the 1876 Philadelphia Centennial Exhibition. He was also a founding member of the Providence Art Club and the Rhode Island School of Design.\nBannister's style and predominantly pastoral subject matter reflected his admiration for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school. A lifelong sailor, he also looked to the Rhode Island seaside for inspiration. Bannister continually experimented, and his artwork displays his Idealist philosophy and his control of color and atmosphere. He began his professional practice as a photographer and portraitist before developing his better-known landscape style.\nLater in his life, Bannister's style of landscape painting fell out of favor. With decreasing painting sales, he and Christiana Carteaux moved out of College Hill in Providence to Boston and then a smaller house on Wilson Street in Providence. Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.\n\n",
        "simplified": "Edward Mitchell Bannister (November 2, 1828 \u2013 January 9, 1901) was a Canadian-American who painted with oils and was part of the American Barbizon school. He was born in what is now New Brunswick, Canada, but he lived most of his adult life in New England, USA. There, he and his wife, Christiana Carteaux, were important in African-American cultural and political groups, like the Boston abolition movement. Bannister became well-known across the country after winning first prize in painting at the 1876 Philadelphia Centennial Exhibition. He helped start both the Providence Art Club and the Rhode Island School of Design.\n\nBannister's painting style showed his love for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school. A sailor all his life, Bannister often found ideas for his paintings at the Rhode Island seaside. He liked to try new things, and his paintings show his Idealist ideas and skill with color and mood. He started out working as a photographer and portrait artist before becoming famous for his landscapes.\n\nTowards the end of his life, Bannister's landscape paintings were not as popular. This led to fewer sales, so he and Christiana Carteaux moved from College Hill in Providence to Boston and then to a smaller house on Wilson Street in Providence. After Bannister died in 1901, people didn't pay much attention to his work until the 1960s and 1970s when places like the National Museum of African Art helped bring him back into the spotlight.",
        "evaluation": {
            "overall_questions": [
                {
                    "key": "fluency",
                    "label": "Fluency: How grammatically correct and well-formed are the sentences?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Many sentences are ungrammatical or nonsensical."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Some sentences are awkward or contain errors."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Mostly fluent, with a few minor awkward phrases."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The text reads naturally with no errors."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The language is exceptionally well-formed and articulate."
                        }
                    ]
                },
                {
                    "key": "clarity",
                    "label": "Clarity: As a stand-alone text, how clear and easy is it to understand the main points?",
                    "options": [
                        {
                            "label": "1 - Very Unclear",
                            "description": "The text is confusing and the main points are hard to grasp."
                        },
                        {
                            "label": "2 - Unclear",
                            "description": "Some parts of the text are confusing or ambiguous."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is generally understandable, but could be clearer."
                        },
                        {
                            "label": "4 - Clear",
                            "description": "The text is easy to understand."
                        },
                        {
                            "label": "5 - Very Clear",
                            "description": "The text is exceptionally easy to follow and unambiguous."
                        }
                    ]
                },
                {
                    "key": "conciseness",
                    "label": "Conciseness: Is the text succinct or does it use unnecessary words?",
                    "options": [
                        {
                            "label": "1 - Very Wordy",
                            "description": "The text is highly repetitive or uses many unnecessary words."
                        },
                        {
                            "label": "2 - Wordy",
                            "description": "The text is somewhat repetitive or wordy."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is mostly concise but could be tightened."
                        },
                        {
                            "label": "4 - Concise",
                            "description": "The text is direct and to the point."
                        },
                        {
                            "label": "5 - Very Concise",
                            "description": "Every word serves a clear purpose."
                        }
                    ]
                },
                {
                    "key": "style",
                    "label": "Style: How appropriate and natural is the writing style?",
                    "options": [
                        {
                            "label": "1 - Very Unnatural",
                            "description": "The style feels robotic, 'dumbed down,' or childish."
                        },
                        {
                            "label": "2 - Slightly Unnatural",
                            "description": "The style is a bit simplistic or awkward in places."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The style is functional but not particularly engaging."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The style is clear, simple, and appropriate for a general audience."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The style is engaging and perfectly suited for the topic."
                        }
                    ]
                },
                {
                    "key": "overall_impression",
                    "label": "Overall: As a stand-alone piece of writing, what is your overall impression of this text?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Unacceptable quality, many flaws."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Has significant flaws that detract from the text."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Generally okay, but with noticeable room for improvement."
                        },
                        {
                            "label": "4 - Good",
                            "description": "Well-written and effective with only minor issues."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "Exceptionally clear, fluent, and well-written."
                        }
                    ]
                }
            ],
            "simplicity_issues": [
                {
                    "type": "meaning",
                    "original_span": "Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.",
                    "simplified_span": "After Bannister died in 1901, people didn't pay much attention to his work until the 1960s and 1970s when places like the National Museum of African Art helped bring him back into the spotlight.",
                    "explanation": "The original text specifies that Bannister was overlooked in American art historical studies and exhibitions, which is a more precise context than the simplified version's 'people didn't pay much attention to his work.' The simplified version loses the specific context of art historical studies and exhibitions.",
                    "suggested_fix": "Revise the simplified text to: 'After Bannister died in 1901, his work was largely overlooked in American art historical studies and exhibitions until the 1960s and 1970s, when places like the National Museum of African Art helped bring him back into the spotlight.'"
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "who painted with oils",
                    "explanation": "The phrase 'who painted with oils' is overly simplistic and could be more specific to enhance understanding.",
                    "suggested_fix": "who was known for his oil paintings"
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "important in African-American cultural and political groups, like the Boston abolition movement",
                    "explanation": "The phrase 'important in African-American cultural and political groups, like the Boston abolition movement' is vague and could benefit from more specificity.",
                    "suggested_fix": "active participants in African-American cultural and political groups, such as the Boston abolition movement"
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "Bannister's painting style showed his love for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school.",
                    "explanation": "The sentence structure is slightly awkward and could be improved for better fluency.",
                    "suggested_fix": "Bannister's painting style reflected his admiration for the French artist Jean-Fran\u00e7ois Millet and the Barbizon school."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "A sailor all his life, Bannister often found ideas for his paintings at the Rhode Island seaside.",
                    "explanation": "The phrase 'A sailor all his life' is misleading as it suggests Bannister was primarily a sailor, which contradicts the focus on his painting career.",
                    "suggested_fix": "Having spent much time by the sea, Bannister often found inspiration for his paintings at the Rhode Island seaside."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "He liked to try new things, and his paintings show his Idealist ideas and skill with color and mood.",
                    "explanation": "The phrase 'Idealist ideas' is abstract and could be clarified for better understanding.",
                    "suggested_fix": "He liked to experiment, and his paintings reflect his idealistic themes and skillful use of color and mood."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "Towards the end of his life, Bannister's landscape paintings were not as popular.",
                    "explanation": "The phrase 'not as popular' is vague and could be more specific to convey the decline in popularity.",
                    "suggested_fix": "Towards the end of his life, Bannister's landscape paintings experienced a decline in popularity."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "people didn't pay much attention to his work until the 1960s and 1970s",
                    "explanation": "The phrase 'people didn't pay much attention' is informal and could be more precise.",
                    "suggested_fix": "his work received little recognition until the 1960s and 1970s"
                }
            ]
        }
    },
    {
        "title": "Edward Mitchell Bannister",
        "model_id": "gemma_editor",
        "original": "Edward Mitchell Bannister (November 2, 1828 \u2013 January 9, 1901) was a Canadian\u2013American oil painter of the American Barbizon school. Born in colonial New Brunswick, he spent his adult life in New England in the United States. There, along with his wife Christiana Carteaux, he was a prominent member of African-American cultural and political communities, such as the Boston abolition movement. Bannister received national recognition after he won a first prize in painting at the 1876 Philadelphia Centennial Exhibition. He was also a founding member of the Providence Art Club and the Rhode Island School of Design.\nBannister's style and predominantly pastoral subject matter reflected his admiration for the French artist Jean-Fran\u00e7ois Millet and the French Barbizon school. A lifelong sailor, he also looked to the Rhode Island seaside for inspiration. Bannister continually experimented, and his artwork displays his Idealist philosophy and his control of color and atmosphere. He began his professional practice as a photographer and portraitist before developing his better-known landscape style.\nLater in his life, Bannister's style of landscape painting fell out of favor. With decreasing painting sales, he and Christiana Carteaux moved out of College Hill in Providence to Boston and then a smaller house on Wilson Street in Providence. Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.\n\n",
        "simplified": "Edward Mitchell Bannister was a Canadian-American painter who lived from 1828 to 1901. He painted using oil paints and was part of a style called the American Barbizon school. He was born in a small area of Canada called New Brunswick and later lived in New England, in the United States. \n\nHe and his wife, Christiana Carteaux, were active in important social and political groups, including the fight against slavery in Boston. Bannister became well-known after winning a prize at the 1876 Philadelphia Centennial Exhibition. He also helped start the Providence Art Club and the Rhode Island School of Design.\n\nBannister\u2019s paintings often showed peaceful countryside scenes, and he was inspired by a French painter named Jean-Fran\u00e7ois Millet and the Barbizon school. He had also spent much of his life as a sailor and found inspiration in the Rhode Island coast. He tried out different techniques and styles, and his work showed his beliefs and his skill with color and light. He started his art career taking photographs and painting portraits before focusing on landscapes.\n\nAs time went on, people didn\u2019t really like his landscape paintings as much, and he sold fewer of them. He and his wife moved away from Providence to Boston and then to a smaller house on Wilson Street. For many years after he died in 1901, he wasn\u2019t recognized by art historians or shown in important exhibitions. However, in the 1960s and 1970s, museums like the National Museum of African Art helped to bring his work back into the public eye.",
        "evaluation": {
            "overall_questions": [
                {
                    "key": "fluency",
                    "label": "Fluency: How grammatically correct and well-formed are the sentences?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Many sentences are ungrammatical or nonsensical."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Some sentences are awkward or contain errors."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Mostly fluent, with a few minor awkward phrases."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The text reads naturally with no errors."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The language is exceptionally well-formed and articulate."
                        }
                    ]
                },
                {
                    "key": "clarity",
                    "label": "Clarity: As a stand-alone text, how clear and easy is it to understand the main points?",
                    "options": [
                        {
                            "label": "1 - Very Unclear",
                            "description": "The text is confusing and the main points are hard to grasp."
                        },
                        {
                            "label": "2 - Unclear",
                            "description": "Some parts of the text are confusing or ambiguous."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is generally understandable, but could be clearer."
                        },
                        {
                            "label": "4 - Clear",
                            "description": "The text is easy to understand."
                        },
                        {
                            "label": "5 - Very Clear",
                            "description": "The text is exceptionally easy to follow and unambiguous."
                        }
                    ]
                },
                {
                    "key": "conciseness",
                    "label": "Conciseness: Is the text succinct or does it use unnecessary words?",
                    "options": [
                        {
                            "label": "1 - Very Wordy",
                            "description": "The text is highly repetitive or uses many unnecessary words."
                        },
                        {
                            "label": "2 - Wordy",
                            "description": "The text is somewhat repetitive or wordy."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The text is mostly concise but could be tightened."
                        },
                        {
                            "label": "4 - Concise",
                            "description": "The text is direct and to the point."
                        },
                        {
                            "label": "5 - Very Concise",
                            "description": "Every word serves a clear purpose."
                        }
                    ]
                },
                {
                    "key": "style",
                    "label": "Style: How appropriate and natural is the writing style?",
                    "options": [
                        {
                            "label": "1 - Very Unnatural",
                            "description": "The style feels robotic, 'dumbed down,' or childish."
                        },
                        {
                            "label": "2 - Slightly Unnatural",
                            "description": "The style is a bit simplistic or awkward in places."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "The style is functional but not particularly engaging."
                        },
                        {
                            "label": "4 - Good",
                            "description": "The style is clear, simple, and appropriate for a general audience."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "The style is engaging and perfectly suited for the topic."
                        }
                    ]
                },
                {
                    "key": "overall_impression",
                    "label": "Overall: As a stand-alone piece of writing, what is your overall impression of this text?",
                    "options": [
                        {
                            "label": "1 - Very Poor",
                            "description": "Unacceptable quality, many flaws."
                        },
                        {
                            "label": "2 - Poor",
                            "description": "Has significant flaws that detract from the text."
                        },
                        {
                            "label": "3 - Acceptable",
                            "description": "Generally okay, but with noticeable room for improvement."
                        },
                        {
                            "label": "4 - Good",
                            "description": "Well-written and effective with only minor issues."
                        },
                        {
                            "label": "5 - Excellent",
                            "description": "Exceptionally clear, fluent, and well-written."
                        }
                    ]
                }
            ],
            "simplicity_issues": [
                {
                    "type": "meaning",
                    "original_span": "Bannister continually experimented, and his artwork displays his Idealist philosophy and his control of color and atmosphere.",
                    "simplified_span": "He tried out different techniques and styles, and his work showed his beliefs and his skill with color and light.",
                    "explanation": "The simplified text does not accurately convey the specific mention of Bannister's 'Idealist philosophy' and 'control of color and atmosphere.' Instead, it vaguely refers to 'his beliefs' and 'skill with color and light,' which may not fully capture the philosophical and technical aspects emphasized in the original.",
                    "suggested_fix": "He tried out different techniques and styles, and his work showed his Idealist philosophy and his skill with color and atmosphere."
                },
                {
                    "type": "meaning",
                    "original_span": "Bannister was overlooked in American art historical studies and exhibitions after his death in 1901, until institutions like the National Museum of African Art returned him to national attention in the 1960s and 1970s.",
                    "simplified_span": "For many years after he died in 1901, he wasn\u2019t recognized by art historians or shown in important exhibitions. However, in the 1960s and 1970s, museums like the National Museum of African Art helped to bring his work back into the public eye.",
                    "explanation": "The simplified text omits the specific mention of 'American art historical studies and exhibitions,' which provides context for where Bannister was overlooked. This omission slightly alters the understanding of the scope of his neglect.",
                    "suggested_fix": "For many years after he died in 1901, he wasn\u2019t recognized in American art historical studies or shown in important exhibitions. However, in the 1960s and 1970s, museums like the National Museum of African Art helped to bring his work back into the public eye."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "a small area of Canada called New Brunswick",
                    "explanation": "The phrase 'a small area of Canada called New Brunswick' is imprecise. New Brunswick is a province, not a small area.",
                    "suggested_fix": "a province in Canada called New Brunswick"
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "He tried out different techniques and styles, and his work showed his beliefs and his skill with color and light.",
                    "explanation": "The sentence contains multiple ideas that could be more clearly expressed if separated.",
                    "suggested_fix": "He experimented with different techniques and styles. His work demonstrated his beliefs and his skill with color and light."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "He started his art career taking photographs and painting portraits before focusing on landscapes.",
                    "explanation": "The sentence structure is slightly awkward and could be improved for better flow.",
                    "suggested_fix": "He began his art career by taking photographs and painting portraits, before eventually focusing on landscapes."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "As time went on, people didn\u2019t really like his landscape paintings as much, and he sold fewer of them.",
                    "explanation": "The phrase 'people didn\u2019t really like his landscape paintings as much' is informal and could be more precise.",
                    "suggested_fix": "Over time, his landscape paintings became less popular, and he sold fewer of them."
                },
                {
                    "type": "writing",
                    "original_span": null,
                    "simplified_span": "For many years after he died in 1901, he wasn\u2019t recognized by art historians or shown in important exhibitions.",
                    "explanation": "The sentence could be more concise and formal.",
                    "suggested_fix": "For many years after his death in 1901, art historians did not recognize him, and his work was not featured in major exhibitions."
                }
            ]
        }
    }
];
// =======================================================================

document.addEventListener('DOMContentLoaded', function() {
    
    if (typeof taskData === 'string' || WEB_APP_URL === 'PASTE_YOUR_WEB_APP_URL_HERE') {
        document.body.innerHTML = '<h1>Error: Data not injected or Web App URL not set in template.html.</h1>';
        return;
    }

    // --- All variables defined here are shared by the functions below ---
    const sourcePanel = document.getElementById('source-panel');
    const tabsContainer = document.getElementById('tabs-container');
    const contentContainer = document.getElementById('content-container');
    const submitContainer = document.getElementById('submit-button-container');
    let prolificId = '';
    
    // Shuffle the data first, so we can define the original text based on the first item.
    shuffleArray(taskData);
    const originalSourceHTML = `<h2>Source Document</h2><p><strong>Title:</strong> ${taskData[0].title}</p><p>${taskData[0].original.replace(/\n/g, '<br>')}</p>`;


    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }


    function buildInterface() {
        const urlParams = new URLSearchParams(window.location.search);
        prolificId = urlParams.get('PROLIFIC_PID') || 'PROLIFIC_ID_NOT_FOUND';

        // --- NEW: Shuffle the taskData array right after it's loaded ---
        shuffleArray(taskData);
        
        sourcePanel.innerHTML = `<h2>Source Document</h2><p><strong>Title:</strong> ${taskData[0].title}</p><p>${taskData[0].original.replace(/\n/g, '<br>')}</p>`;
        
        let tabsHTML = '<button type="button" class="tab-button active" data-tab="instructions">Instructions</button>';
        taskData.forEach((_, i) => { tabsHTML += `<button type="button" class="tab-button" data-tab="s${i}">Version ${i + 1}</button>`; });
        tabsHTML += '<button type="button" class="tab-button" data-tab="comparison">Final Comparison</button>';
        tabsContainer.innerHTML = tabsHTML;

        let contentHTML = `<div id="instructions" class="tab-content active"><h3>Instructions</h3><p>Please evaluate each simplification by proceeding through the tabs. Within each tab, use the 'Next' and 'Previous' buttons to move through the evaluation pages.</p></div>`;
        taskData.forEach((simp, i) => { contentHTML += generateSimplificationTabHTML(simp, i); });
        contentHTML += generateFinalComparisonHTML(taskData);
        contentContainer.innerHTML = contentHTML;

        initializeInteractivity();
    }

    function generateSimplificationTabHTML(simplification, simpIndex) {
        const pages = [];
        const escapeRegExp = (string) => string ? string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') : '';
        const createRadioOption = (name, value, labelText, tooltipText) => `<label class="radio-option-label"><input type="radio" name="${name}" value="${value}"> ${labelText} <span class="tooltip-container">i<span class="tooltip-text">${tooltipText}</span></span></label>`;
        
        const overallQuestionsHTML = simplification.evaluation.overall_questions.map(q => {
            const labelParts = q.label.split(/:(.*)/s);
            const mainLabel = labelParts[0] + ':';
            const description = labelParts[1] || '';
            const optionsHTML = q.options.map(opt => createRadioOption(`s${simpIndex}_${q.key}`, opt.label, opt.label, opt.description)).join('');
            return `<div class="question-block"><label>${mainLabel}<span class="question-description">${description}</span></label>${optionsHTML}</div>`;
        }).join('');
        pages.push({type: 'overall', content: `<h3>Overall Quality Questions</h3><div class="wizard-context-header"><p>${simplification.simplified.replace(/\n/g, '<br>')}</p></div>${overallQuestionsHTML}` });

        simplification.evaluation.simplicity_issues.forEach((issue, issueIndex) => {
            const highlightedSimplified = issue.simplified_span ? simplification.simplified.replace(new RegExp(escapeRegExp(issue.simplified_span), 'g'), `<mark>${issue.simplified_span}</mark>`) : simplification.simplified;
            let contextHTML = `<div class="context-sub-header"></div><p>${highlightedSimplified.replace(/\n/g, '<br>')}</p>`;
            const severityOptions = createRadioOption(`s${simpIndex}_span${issueIndex}_severity`, "Major", "Major Issue", "Significantly harms comprehension or quality.") + createRadioOption(`s${simpIndex}_span${issueIndex}_severity`, "Minor", "Minor Issue", "Small issue that could be improved.") + createRadioOption(`s${simpIndex}_span${issueIndex}_severity`, "Not an issue", "No Issue", "The text is acceptable as is.");
            const explanationOptions = createRadioOption(`s${simpIndex}_span${issueIndex}_explanation`, "Correct", "Correct", "Identifies and describes the main issue.") + createRadioOption(`s${simpIndex}_span${issueIndex}_explanation`, "Partially Correct", "Partially Correct", "Identifies a real issue, but the explanation is incomplete or inaccurate.") + createRadioOption(`s${simpIndex}_span${issueIndex}_explanation`, "Incorrect", "Incorrect", "Describes a problem that doesn't actually exist.");
            const fixOptions = createRadioOption(`s${simpIndex}_span${issueIndex}_fix`, "Solves the issue", "Solves", "This is a clear and successful improvement.") + createRadioOption(`s${simpIndex}_span${issueIndex}_fix`, "Partial improvement", "Partial", "The fix is slightly better, but the text could still be improved.") + createRadioOption(`s${simpIndex}_span${issueIndex}_fix`, "No difference", "No Difference", "The fix is neither better nor worse than the original text.") + createRadioOption(`s${simpIndex}_span${issueIndex}_fix`, "Worse", "Worse", "The suggested fix is actually a regression.");
            pages.push({type: issue.type, originalSpan: issue.original_span, content: `<h3>Span Evaluation (${issueIndex + 1}/${simplification.evaluation.simplicity_issues.length})</h3><div class="wizard-context-header">${contextHTML}</div><div class="question-block"><p><strong>Explanation:</strong> ${issue.explanation}</p><p><strong>Suggested Fix:</strong> <span style="color:#28a745;">${issue.suggested_fix}</span></p></div><div class="question-block"><label>How would you rate this issue?</label>${severityOptions}</div><div class="question-block"><label>How accurate is the LLM's explanation?</label>${explanationOptions}</div><div class="question-block"><label>Is the suggested fix an improvement?</label>${fixOptions}</div>`});
        });
        
        pages.push({
            type: 'feedback',
            content: `<h3>Additional Feedback</h3>
                    <div class="wizard-context-header"><p>${simplification.simplified.replace(/\n/g, '<br>')}</p></div>
                    <div class="question-block">
                        <label>Did you notice any other issues while reading that were not highlighted? If so, please paste relevant spans here or describe them below.</label>
                        <textarea name="s${simpIndex}_missed_issues_text" class="missed-issues-textarea" data-simp-index="${simpIndex}" rows="5" style="width: 95%; padding: 5px;"></textarea>
                        <div style="margin-top: 10px;"><label><input type="checkbox" name="s${simpIndex}_missed_issues_none" class="missed-issues-none-checkbox" data-simp-index="${simpIndex}" value="None"> I did not notice any other issues.</label></div>
                    </div>`
        });
        const wizardPagesHTML = pages.map((page, pageIndex) => `<div class="wizard-page" data-page-index="${pageIndex}" data-issue-type="${page.type}" data-original-span="${page.originalSpan || ''}">${page.content}<div class="wizard-nav"><button type="button" class="wizard-nav-button prev" style="visibility: ${pageIndex > 0 ? 'visible' : 'hidden'};">&laquo; Previous</button><span>Page ${pageIndex + 1} of ${pages.length}</span><button type="button" class="wizard-nav-button next" style="visibility: ${pageIndex < pages.length - 1 ? 'visible' : 'hidden'};">Next &raquo;</button></div></div>`).join('');
        return `<div id="s${simpIndex}" class="tab-content wizard-container">${wizardPagesHTML}</div>`;
    }
    
    function generateFinalComparisonHTML(data) {
        let optionsHTML = data.map((task, i) => `<label style="margin-right: 15px;"><input type="radio" name="final_choice" value="${task.model_id}"> Version ${i+1}</label>`).join('');
        return `<div id="comparison" class="tab-content"><h3>Final Comparison</h3><div class="question-block"><label>Which simplification was the best overall?</label>${optionsHTML}<label style="margin-right: 15px;"><input type="radio" name="final_choice" value="All Equal"> All were about equal</label></div></div>`;
    }

    function highlightSourceSpan(spanText) {
        sourcePanel.innerHTML = originalSourceHTML;
        
        if (spanText && spanText !== 'null') {
            const escapeRegExp = (string) => string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const highlightedHTML = originalSourceHTML.replace(
                new RegExp(escapeRegExp(spanText), 'g'),
                `<mark>${spanText}</mark>`
            );
            sourcePanel.innerHTML = highlightedHTML;
        }
    }

    function initializeInteractivity() {
        // --- THIS FUNCTION NOW LIVES INSIDE INITIALIZEINTERACTIVITY ---
        function highlightSourceSpan(spanText) {
            // Always start with the clean, un-highlighted version of the source text
            sourcePanel.innerHTML = originalSourceHTML;
            
            // If there's a span to highlight, find it and wrap it in <mark> tags
            if (spanText && spanText !== 'null') {
                const escapeRegExp = (string) => string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const highlightedHTML = originalSourceHTML.replace(
                    new RegExp(escapeRegExp(spanText), 'g'),
                    `<mark>${spanText}</mark>`
                );
                sourcePanel.innerHTML = highlightedHTML;
            }
        }

        // Tab switching logic
        tabsContainer.addEventListener('click', (e) => {
            if (e.target.matches('.tab-button')) {
                const tabId = e.target.dataset.tab;
                if(tabsContainer.querySelector('.active')) tabsContainer.querySelector('.active').classList.remove('active');
                if(contentContainer.querySelector('.tab-content.active')) contentContainer.querySelector('.tab-content.active').classList.remove('active');
                e.target.classList.add('active');
                const newTabContent = contentContainer.querySelector(`#${tabId}`);
                if (newTabContent) newTabContent.classList.add('active');
                submitContainer.style.display = (tabId === 'comparison') ? 'block' : 'none';
                
                highlightSourceSpan(null);
            }
        });

        // Wizard navigation logic
        contentContainer.addEventListener('click', (e) => {
            if (e.target.matches('.wizard-nav-button')) {
                const wizardContainer = e.target.closest('.wizard-container');
                const currentPage = e.target.closest('.wizard-page');
                let currentPageIndex = parseInt(currentPage.dataset.pageIndex, 10);
                currentPageIndex += e.target.matches('.next') ? 1 : -1;
                const newActivePage = wizardContainer.querySelector(`.wizard-page[data-page-index="${currentPageIndex}"]`);
                if (newActivePage) {
                    currentPage.classList.remove('active');
                    newActivePage.classList.add('active');
                    const spanToHighlight = newActivePage.dataset.originalSpan;
                    highlightSourceSpan(spanToHighlight);
                }
            }
        });
        
        document.querySelectorAll('.wizard-container').forEach(container => container.querySelector('.wizard-page')?.classList.add('active'));
        
        document.getElementById('evaluation-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const submitButton = document.getElementById('submit-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting... Please Wait';

            const allFormData = new FormData(document.getElementById('evaluation-form'));
            const allSubmissions = [];

            taskData.forEach((simplification, simpIndex) => {
                const dataToSubmit = {};
                
                dataToSubmit['Prolific ID'] = prolificId;
                dataToSubmit['Document Title'] = simplification.title;
                dataToSubmit['Simplification Model ID'] = simplification.model_id;

                simplification.evaluation.overall_questions.forEach(q => {
                    dataToSubmit[q.label] = allFormData.get(`s${simpIndex}_${q.key}`) || '';
                });

                simplification.evaluation.simplicity_issues.forEach((issue, issueIndex) => {
                    const spanNum = issueIndex + 1;
                    dataToSubmit[`Span ${spanNum} Text`] = issue.simplified_span || 'SPAN_NOT_FOUND';
                    dataToSubmit[`Span ${spanNum} - Issue Severity`] = allFormData.get(`s${simpIndex}_span${issueIndex}_severity`) || '';
                    dataToSubmit[`Span ${spanNum} - Explanation Accuracy`] = allFormData.get(`s${simpIndex}_span${issueIndex}_explanation`) || '';
                    dataToSubmit[`Span ${spanNum} - Fix Improvement`] = allFormData.get(`s${simpIndex}_span${issueIndex}_fix`) || '';
                });

                const missedIssuesText = allFormData.get(`s${simpIndex}_missed_issues_text`);
                const isNoneChecked = allFormData.get(`s${simpIndex}_missed_issues_none`);
                dataToSubmit['Missed Issues Text'] = isNoneChecked ? 'None' : missedIssuesText || '';
                dataToSubmit['No Missed Issues Found'] = isNoneChecked ? 'Checked' : '';
                
                if (simpIndex === taskData.length - 1) {
                    dataToSubmit['Final Comparison Choice'] = allFormData.get('final_choice') || '';
                }
                
                allSubmissions.push(dataToSubmit);
            });

            fetch(WEB_APP_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'text/plain;charset=utf-8',
                },
                body: JSON.stringify(allSubmissions),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if (data.status === 'success') {
                    window.location.href = PROLIFIC_COMPLETION_URL;
                } else {
                    throw new Error(data.message || 'The script reported an unknown error.');
                }
            })
            .catch(error => {
                console.error("A critical error occurred during submission:", error);
                alert("A submission error occurred. Your responses could not be saved. Please contact the researcher.");
                submitButton.disabled = false;
                submitButton.textContent = 'Submit All Evaluations';
            });
        });
    }
    buildInterface();
});
</script>

</body>
</html>