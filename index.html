<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Evaluation</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: #333; max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        .header { text-align: center; border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .container { display: flex; flex-wrap: wrap; gap: 30px; }
        .document { flex: 1; min-width: 300px; border: 1px solid #ccc; padding: 15px; height: 500px; overflow-y: scroll; background: #fdfdfd; }
        .evaluation-area { width: 100%; margin-top: 30px; }
        h1, h2, h3 { color: #0056b3; }
        h2 { border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .span-evaluation { border: 1px solid #ddd; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; background-color: #fafafa; }
        .question-block { margin-top: 15px; }
        .question-block label { font-weight: bold; display: block; margin-bottom: 5px; }
        .prolific-id-input { padding: 8px; width: 300px; margin-top: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #eee; }
        .submit-section { text-align: center; margin-top: 40px; }
        #submit-button { padding: 15px 25px; background-color: #28a745; color: white; text-decoration: none; border-radius: 8px; font-size: 20px; font-weight: bold; border: none; cursor: pointer; }
        #submit-button:disabled { background-color: #ccc; }
        mark { background-color: #ffeb3b; padding: 2px 0; border-radius: 3px; }
    </style>
</head>
<body>

<form id="evaluation-form">
    <div class="header">
        <h1>Document Evaluation</h1>
        <p>Your Prolific ID has been automatically recorded. Please review the documents and answer the questions below.</p>
        <div class="question-block">
            <label for="prolific-id">Prolific ID</label>
            <input type="text" id="prolific-id" class="prolific-id-input" name="entry.712531781" placeholder="Loading Prolific ID..." required>
        </div>
    </div>
    
    <div class="container">
        <div class="document">
            <h2>Original Document</h2>
            <p>Banksia aculeata, commonly known as prickly banksia...</p>
        </div>
        <div id="simplified-doc" class="document">
            <h2>Simplified Document</h2>
            <p>Banksia aculeata, also called prickly banksia, is a type of plant...</p>
        </div>
    </div>

    <div class="evaluation-area">
        <h2>Span Evaluations</h2>
        
        <div class="span-evaluation">
            <h3>1. Span: "Proteaceae family"</h3>
            <div class="question-block">
                <label>Do you agree with the issue identified?</label>
                <input type="radio" name="entry.371527831" value="Yes" required> Yes
                <input type="radio" name="entry.371527831" value="No"> No
            </div>
            <div class="question-block">
                <label>Is the suggested fix an improvement?</label>
                <input type="radio" name="entry.1108020156" value="Yes, it is an improvement" required> Yes
                <input type="radio" name="entry.1108020156" value="No, it is not an improvement"> No
                <input type="radio" name="entry.1108020156" value="It makes no difference"> No Difference
            </div>
        </div>

        <div class="span-evaluation">
            <h3>2. Span: "It naturally grows..."</h3>
            <div class="question-block">
                <label>Do you agree with the issue identified?</label>
                <input type="radio" name="entry.1063948710" value="Yes" required> Yes
                <input type="radio" name="entry.1063948710" value="No"> No
            </div>
            <div class="question-block">
                <label>Is the suggested fix an improvement?</label>
                <input type="radio" name="entry.1579240662" value="Yes, it is an improvement" required> Yes
                <input type="radio" name="entry.1579240662" value="No, it is not an improvement"> No
                <input type="radio" name="entry.1579240662" value="It makes no difference"> No Difference
            </div>
        </div>
        
        <div class="span-evaluation">
            <h3>3. Span: "Even though the naturalist..."</h3>
            <div class="question-block">
                <label>Do you agree with the issue identified?</label>
                <input type="radio" name="entry.1057746107" value="Yes" required> Yes
                <input type="radio" name="entry.1057746107" value="No"> No
            </div>
            <div class="question-block">
                <label>Is the suggested fix an improvement?</label>
                <input type="radio" name="entry.909543965" value="Yes, it is an improvement" required> Yes
                <input type="radio" name="entry.909543965" value="No, it is not an improvement"> No
                <input type="radio" name="entry.909543965" value="It makes no difference"> No Difference
            </div>
        </div>

        <div class="span-evaluation">
            <h3>4. Span: "It lives in areas that get burned..."</h3>
            <div class="question-block">
                <label>Do you agree with the issue identified?</label>
                <input type="radio" name="entry.588599697" value="Yes" required> Yes
                <input type="radio" name="entry.588599697" value="No"> No
            </div>
            <div class="question-block">
                <label>Is the suggested fix an improvement?</label>
                <input type="radio" name="entry.287978224" value="Yes, it is an improvement" required> Yes
                <input type="radio" name="entry.287978224" value="No, it is not an improvement"> No
                <input type="radio" name="entry.287978224" value="It makes no difference"> No Difference
            </div>
        </div>

        <div class="span-evaluation">
            <h3>5. Span: "Unlike other banksias..."</h3>
            <div class="question-block">
                <label>Do you agree with the issue identified?</label>
                <input type="radio" name="entry.1742029395" value="Yes" required> Yes
                <input type="radio" name="entry.1742029395" value="No"> No
            </div>
            <div class="question-block">
                <label>Is the suggested fix an improvement?</label>
                <input type="radio" name="entry.50372195" value="Yes, it is an improvement" required> Yes
                <input type="radio" name="entry.50372195" value="No, it is not an improvement"> No
                <input type="radio" name="entry.50372195" value="It makes no difference"> No Difference
            </div>
        </div>
    </div>

    <div class="submit-section">
        <button type="submit" id="submit-button">Submit Answers and Complete Study</button>
    </div>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- Part 1: Auto-fill Prolific ID ---
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const prolificId = urlParams.get('PROLIFIC_PID');
            const idInput = document.querySelector('input[name="entry.712531781"]');

            if (prolificId && idInput) {
                idInput.value = prolificId;
                idInput.readOnly = true;
            } else if (idInput) {
                idInput.placeholder = 'COULD NOT FIND PROLIFIC ID IN URL';
            }
        } catch(e) { console.error("Error getting Prolific ID:", e); }

        // --- Part 2: Highlight Spans ---
        const spansToHighlight = [
            "Proteaceae family",
            "It naturally grows in the Stirling Range in the southwest of Western Australia.",
            "Even though the naturalist James Drummond collected it in the 1840s, Banksia aculeata was not officially described until 1981 by Alex George in his detailed study of the species.",
            "It lives in areas that get burned by bushfires from time to time.",
            "Unlike other banksias in Western Australia, it seems to be somewhat resistant to a soil-borne mould called Phytophthora cinnamomi."
        ];
        const simplifiedDoc = document.getElementById('simplified-doc');
        if (simplifiedDoc) {
            let content = simplifiedDoc.innerHTML;
            spansToHighlight.forEach(span => {
                const regex = new RegExp(span.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                content = content.replace(regex, `<mark>${span}</mark>`);
            });
            simplifiedDoc.innerHTML = content;
        }

        // --- Part 3: Handle Form Submission ---
        const form = document.getElementById('evaluation-form');
        if (form) {
            form.addEventListener('submit', function(e) {
                // PREVENT the browser's default submission behavior
                e.preventDefault();

                const submitButton = document.getElementById('submit-button');
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting, please wait...';

                // --- CONFIGURATION ---
                const formActionUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSddOIJxcLnfFFEd34mOlPkzUP31S-QKWrMM94zynYY8ASDXXg/formResponse';
                
                // IMPORTANT: PASTE YOUR REAL PROLIFIC URL IN THE LINE BELOW
                const prolificCompletionUrl = 'PASTE_YOUR_PROLIFIC_COMPLETION_URL_HERE';
                // --- END CONFIGURATION ---

                // Check if the URL was filled
                if (prolificCompletionUrl.includes('PASTE_YOUR_PROLIFIC')) {
                    alert('ERROR: The prolificCompletionUrl has not been set in the HTML file. Please contact the researcher.');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Answers and Complete Study';
                    return; // Stop the submission
                }

                fetch(formActionUrl, {
                    method: 'POST',
                    body: new FormData(form),
                    mode: 'no-cors'
                })
                .then(response => {
                    console.log('Submission sent. Redirecting to Prolific.');
                    // This will now correctly redirect the user back to Prolific
                    window.location.href = prolificCompletionUrl;
                })
                .catch(error => {
                    console.error('Submission Error:', error);
                    alert('A critical error occurred while submitting. Please refresh the page and try again. If the problem persists, please contact the researcher.');
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Answers and Complete Study';
                });
            });
        }
    });
</script>
</body>
</html>